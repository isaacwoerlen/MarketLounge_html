<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <title>README_glossary.md</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <h1>README_glossary.md</h1>
    <pre><code>---

# ğŸ“˜ README â€” App `glossary`

> Ce fichier respecte les conventions dÃ©crites dans [`README Brief Technique.md`](../README Brief Technique.md), situÃ© Ã  la racine du dossier `apps/`.  
> Il dÃ©crit lâ€™objectif, le type, les composants, lâ€™intÃ©gration, et les responsabilitÃ©s internes de lâ€™app.

---

## ğŸ§© Type dâ€™app

| Type         | Description                                                                 |
|--------------|------------------------------------------------------------------------------|
| Transversale | Fournit un service technique rÃ©utilisable par plusieurs apps                |
| Verticale    | App mÃ©tier qui utilise les services des apps transverses                    |

> Cette app est de type : **`verticale`**  
> Elle dÃ©pend des apps transverses suivantes :
> - `language` : pour la traduction automatique
> - `seo` : pour lâ€™injection des champs SEO
> - `faiss_pgvector` : pour la vectorisation et la recherche sÃ©mantique

---

## ğŸ”— DÃ©pendances

| App              | RÃ´le dans `glossary`                                                                 |
|------------------|--------------------------------------------------------------------------------------|
| `language`       | Traduction automatique des champs multilingues (`labels`, `definition`, `seo`)      |
| `seo`            | GÃ©nÃ©ration et validation des blocs SEO multilingues                                 |
| `faiss_pgvector` | Encodage des dÃ©finitions en vecteurs + recherche sÃ©mantique via FAISS               |

```python
## ğŸ“¦ Imports nÃ©cessaires

from apps.language.utils import get_active_langs
from seo.models import SEOblock
from faiss_pgvector.embeddings import encode_text
```

---

## ğŸ¯ Objectif

Lâ€™app `glossary` structure les savoir-faire industriels sous forme de nÅ“uds typÃ©s et gouvernÃ©s :  
**MÃ©tier**, **OpÃ©ration**, **Variante**.

Les nÅ“uds sont reliÃ©s entre eux par des liens multiples (`parents`), mais chaque **variante** est engagÃ©e dans un **path canonique unique** du type :

```
MÃ©tier â†’ OpÃ©ration â†’ Variante
```

Ce path est :
- TypÃ© et gouvernÃ©
- Stable dans le temps
- UtilisÃ© comme clÃ© de matching IA pour lâ€™enrichissement, la vectorisation et la recherche

> Il ne sâ€™agit pas dâ€™une hiÃ©rarchie stricte : les liens entre nÅ“uds sont multiples, mais le path canonique est unique par variante.

---

## ğŸ§± ModÃ¨le principal

### `GlossaryNode`

- ReprÃ©sente un terme ou concept du glossaire
- Contient les champs principaux : `title`, `definition`, `seo`, `embedding`, `alerts`
- Est enrichi automatiquement via IA (dÃ©finition, SEO, vecteur)

```python
class GlossaryNode(models.Model):
    glossary_id = models.CharField(...)       # identifiant canonique
    node_id = models.CharField(...)           # slug UX
    type = models.CharField(...)              # mÃ©tier / opÃ©ration / variante
    labels = models.JSONField(...)            # noms multilingues
    definition = models.JSONField(...)        # contenu multilingue
    seo = models.JSONField(...)               # SEO multilingue
    embedding = VectorField(dim=384, ...)     # vecteur sÃ©mantique
    alerts = models.JSONField(default=list)   # alertes IA
    parent = models.ForeignKey(...)           # lien unique vers le parent
    ...
```

> Les champs traduisibles sont synchronisÃ©s avec le modÃ¨le `TranslatableKey` de lâ€™app `language`.

---

## ğŸ§  Logique mÃ©tier

- Les nÅ“uds sont typÃ©s (`mÃ©tier`, `opÃ©ration`, `variante`) et gouvernÃ©s
- Chaque variante est engagÃ©e dans un **path canonique unique** (`mÃ©tier â†’ opÃ©ration â†’ variante`)
- Ce path est utilisÃ© pour :
  - Lâ€™enrichissement sÃ©mantique via Mistral API
  - Le calcul dâ€™embedding via `faiss_pgvector`
  - La recherche sÃ©mantique via FAISS
- Les champs multilingues sont traduits automatiquement via `language`
- Les alertes IA signalent les incohÃ©rences ou enrichissements Ã  valider
- La synchronisation avec `TranslatableKey` est assurÃ©e dans `services.py` ou `utils.py`

---

## ğŸ§­ RÃ¨gles de structuration

```python
if t == GlossaryType.METIER and self.parent is not None:
    raise ValidationError("Un 'mÃ©tier' ne doit pas avoir de parent.")
if t == GlossaryType.OPERATION and self.parent.type != GlossaryType.METIER:
    raise ValidationError("Une 'opÃ©ration' doit avoir un parent de type 'mÃ©tier'.")
if t == GlossaryType.VARIANTE and self.parent.type != GlossaryType.OPERATION:
    raise ValidationError("Une 'variante' doit avoir un parent de type 'opÃ©ration'.")
```

---

## ğŸ”Œ IntÃ©grations externes

- **Mistral API** : enrichissement sÃ©mantique des dÃ©finitions
- **Societe.com API** : (optionnel) rÃ©cupÃ©ration de donnÃ©es dâ€™entreprise

---

## â± TÃ¢ches Celery

- Recalcul des embeddings
- Mise Ã  jour de lâ€™index FAISS
- Traduction en batch
- Enrichissement automatique

---

## ğŸ§ª Tests

- Localisation : `apps/glossary/tests/`
- Framework : `pytest`
- GÃ©nÃ©ration : `factory_boy`
- Couverture : `pytest-cov`

---

## ğŸ“‚ Structure interne de lâ€™app

```plaintext
glossary/
â”œâ”€â”€ apps.py                         # Configuration Django de lâ€™app
â”œâ”€â”€ models.py                       # GlossaryNode, SEO, embedding
â”œâ”€â”€ services.py                     # Logique mÃ©tier : enrichissement, traduction, vectorisation
â”œâ”€â”€ utils.py                        # Helpers SEO, JSON, traduction
â”œâ”€â”€ tasks.py                        # TÃ¢ches IA, FAISS, traduction
â”œâ”€â”€ admin.py                        # Interface dâ€™administration, alertes IA
â”œâ”€â”€ forms.py                        # Formulaires multilingues, SEO
â”œâ”€â”€ serializers.py                  # API, validation, lecture seule sur embedding
â”œâ”€â”€ views.py                        # Endpoints API
â”œâ”€â”€ urls.py                         # Routage local
â”œâ”€â”€ permissions.py                  # RÃ¨gles dâ€™accÃ¨s
â”œâ”€â”€ signals.py                      # RÃ©actions aux Ã©vÃ©nements (optionnel)
â”œâ”€â”€ management/commands/            # Commandes CLI pour enrichir les nÅ“uds
â”œâ”€â”€ templates/admin/glossary/       # Assistant de traduction IA
â”œâ”€â”€ static/glossary/                # JS/CSS spÃ©cifique Ã  lâ€™admin
â”œâ”€â”€ specific/fixtures/              # Fixtures ou scripts non partagÃ©s
â””â”€â”€ tests/                          # Tests unitaires
```

---

## ğŸ§­ RÃ¨gles de structuration

- Les champs traduisibles sont synchronisÃ©s avec `language`
- Le SEO est gÃ©rÃ© via `seo` et validÃ© dans le formulaire admin
- Les embeddings sont gÃ©nÃ©rÃ©s via `faiss_pgvector` et stockÃ©s en base
- Les recherches sÃ©mantiques sont dÃ©lÃ©guÃ©es Ã  FAISS
- Les enrichissements IA sont orchestrÃ©s via tÃ¢ches Celery et commandes
- Lâ€™app respecte lâ€™ordre de dÃ©veloppement dÃ©fini dans [`README Brief Technique.md`](../README Brief Technique.md)
- Les responsabilitÃ©s des fichiers sont strictement dÃ©limitÃ©es
- Toute logique mÃ©tier complexe est placÃ©e dans `services.py`
- Les appels aux apps transverses sont explicites et documentÃ©s
- Les champs traduisibles sont synchronisÃ©s via `TranslatableKey`, avec la logique placÃ©e dans `services.py` ou `utils.py` selon le besoin
- Aucun fichier inutile ne doit Ãªtre prÃ©sent

---</code></pre>
</body>
</html>